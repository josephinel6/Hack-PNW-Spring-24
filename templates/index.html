<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Folder Upload</title>
    <style>
        :root {
            --text: black;
            --accent: rgb(143, 95, 240);
        }

        /* CSS styles */
        .hidden {
            display: none;
            /* Hide the answer bar initially */
        }

        body {
            background-color: #dde3f8;
            color: var(--text);
            font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
            margin-left: 20px;
            margin-top: 5vh;
        }

        h1 {
            color: var(--text);
            margin-left: 20px;
            margin-top: 20px;
            /* font-size: large; */
            font-size: 1.7em;
            margin-bottom: 0.25em;
        }

        #loading {
            margin-top: 5vh;
            display: none;
            align-self: center;
            height: 4vw;
            width: 4vw;
            margin-left: 48vw;
        }

        label {
            color: var(--text);
            font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        }

        .image {
            width: 10%;
            aspect-ratio: 1/1;
            margin: 0.3%;
            object-fit: cover;
            display: inline-block;
        }

        .image:hover {
            cursor: pointer;
        }

        #image-grid {
            display: flexbox;
            width: 100%;
            margin-top: 0;
            justify-content: center;
            align-items: center;
            padding-left: 20px;
            padding-right: 20px;
        }

        label,
        button {
            margin-left: 20px;
        }

        #scoreDisplay {
            width: 100vw;
            min-height: 0;
            padding: 0;
            margin: 0;
            /* height: 20px; */
            margin-left: 20px;
            height: 5vh;
            font-size: 1.1em;
        }

        #nameDisplay {
            width: 100vw;
            height: 8vh;
            padding: 0;
            margin-top: 2vh;
            font-size: 1.4em;
            margin: 0;
            /* height: 20px; */
            text-align: center;
        }

        #folderUpload {
            margin-top: 2vh;
            margin-bottom: 2vh;
            margin-left: 20px;
        }

        #upload-files {
            border-radius: 0.5em;
            background-color: var(--accent);
            padding-left: 0.9em;
            padding-right: 0.9em;
            padding-top: 0.5em;
            padding-bottom: 0.5em;
            color: white;
            /* font-weight: bold; */
            font-size: 1em;
            border: none;
        }

        #options {
            display: none;
        }

        .button {
            border-radius: 0.25em;
            background-color: var(--accent);
            padding-left: 0.8em;
            padding-right: 0.8em;
            margin-right: 0;
            padding-top: 0.4em;
            padding-bottom: 0.4em;
            color: white;
            /* font-weight: bold; */
            font-size: 0.95em;
            border: none;
        }

        #game {
            margin-top: 2vh;
            background-color: white;
            border-width: 1px;
            border-style: solid;
            border-color: black;
            margin-left: 20px;
            margin-right: 20px;
        }
    </style>
</head>

<body>
    <div id="welcome">
        <h1>Welcome! Upload a folder of photos to get started playing!</h1>
        <label for="folderUpload" style="font-size: 0.9em"><i>The file name of each photo in the folder should be the
                name
                of the person that photo corresponds to.</i></label>
        <br>
        <input type="file" id="folderUpload" name="folderUpload" webkitdirectory directory multiple>
        <br>
        <button type="submit" onclick="saveFiles()" id="upload-files">Upload!</button>
    </div>
    <div id="options">
        <h1> Which would you like to play?</h1>
        <button onclick="runPhotoMatch()" class="button"> Match photo to name </button>
        <button onclick="runTypeName()" class="button" style="margin-left: 0;"> Type name </button>
    </div>

    <div id="answerBar" class="hidden"> <!-- Initially hidden -->
        <label for="answer">Enter your answer:</label>
        <input type="text" id="answer" name="answer">
        <button onclick="checkAnswer()">Check Answer</button>
        <p id="result"></p>
    </div>



    <!-- <div id="image-grid">
        <img class="image" src="../Images test/image.jpg">
        <img class="image" src="../Images test/image2.jpg">
        <img class="image" src="../Images test/img3.jpg">
        <img class="image" src="../Images test/download.jpg">
        <img class="image" src="../Images test/image.jpg">
        <img class="image" src="../Images test/image2.jpg">
        <img class="image" src="../Images test/img3.jpg">
        <img class="image" src="../Images test/download.jpg">
    </div> -->


    <script>
        var files = [];
        var names = [];


        function saveFiles() {
            document.getElementById("welcome").style.display = "none";
            var loading = document.createElement("img");
            loading.src = "../loading.gif";
            loading.id = "loading";
            document.body.appendChild(loading);
            sleep(500).then(() => {
                loading.remove();
                files = document.getElementById("folderUpload").files;
                getNames();
                document.getElementById("options").style.display = "block";
            })
        }

        function sleep(time) {
            return new Promise((resolve) => setTimeout(resolve, time));
        }

        var inGame = false;
        var found = false;
        var currentPerson;
        var score = 0;

        var scoreDisplay, scoreText, showScore, nameDisplay, nameText, showName;

        function runPhotoMatch() {
            if (inGame == true) {
                if (window.confirm("There is already a game open. Would you like to exit this and start a new one?")) {
                    var currentGame = document.getElementById("game");
                    currentGame.remove();
                }
            }
            inGame = true;

            var game = document.createElement("div");
            game.id = "game";

            scoreDisplay = document.createElement("div");
            scoreDisplay.style.padding = 0;
            scoreDisplay.id = "scoreDisplay";
            scoreText = document.createElement("p");
            scoreText.innerHTML = "Score: ";
            scoreText.style.display = "inline-block";
            game.appendChild(scoreDisplay);
            scoreText.style.marginRight = "5px";
            scoreDisplay.appendChild(scoreText);
            showScore = document.createElement("p");
            showScore.style.display = "inline-block";
            scoreDisplay.appendChild(showScore);
            showScore.id = "score";

            nameDisplay = document.createElement("div");
            nameDisplay.style.padding = 0;
            nameDisplay.id = "nameDisplay";
            nameText = document.createElement("p");
            nameText.innerHTML = "Find";
            nameText.style.marginRight = "5px";
            nameText.style.display = "inline-block";
            showName = document.createElement("p");
            showName.style.display = "inline-block";
            nameDisplay.appendChild(nameText);
            nameDisplay.appendChild(showName);
            game.appendChild(nameDisplay);

            document.body.appendChild(game);

            var imageGrid = document.createElement("div");
            imageGrid.id = "image-grid";
            game.appendChild(imageGrid);

            for (var i = 0; i < files.length; i++) {
                console.log(files[i]);
                var img = document.createElement("img");
                img.className = "image";
                imageGrid.appendChild(img);
                img.setAttribute("src", URL.createObjectURL(files[i]))
                img.src = URL.createObjectURL(files[i]);
                var thisName = names[i];
                img.id = names[i].replace(" ", "-")
                img.onclick = functionHandler(names[i])
            }

            var num = Math.floor(Math.random() * (files.length));
            showName.innerHTML = names[num];
            currentPerson = names[num];
        }



        var functionHandler = function (param) {
            return function () { check(param) };
        }

        function runTypeName() {
            if (inGame == true) {
                if (window.confirm("There is already a game open. Would you like to exit this and start a new one?")) {
                    var currentGame = document.getElementById("game");
                    document.body.remove(game);
                }
            }
            inGame = true;

            document.getElementById("answerBar").classList.remove("hidden");

            var game = document.createElement("div");
            game.id = "game";
            score = 0;

            var scoreDisplay = document.createElement("p");
            var name = document.createElement("p");

            document.body.appendChild(game);

            scoreDisplay = document.createElement("div");
            scoreDisplay.style.padding = 0;
            scoreDisplay.id = "scoreDisplay";
            scoreText = document.createElement("p");
            scoreText.innerHTML = "Score: ";
            scoreText.style.display = "inline-block";
            game.appendChild(scoreDisplay);
            scoreText.style.marginRight = "5px";
            scoreDisplay.appendChild(scoreText);
            showScore = document.createElement("p");
            scoreDisplay.appendChild(showScore);
            showScore.id = "score";

            game.appendChild(scoreDisplay);
            game.appendChild(name);

            var imageGrid = document.createElement("div");
            imageGrid.id = "image-grid";
            game.appendChild(imageGrid);

            // Randomly select an index within the range of files array
            var randomIndex = Math.floor(Math.random() * files.length);

            // Create an image element
            var img = document.createElement("img");
            img.className = "image";
            img.setAttribute("src", URL.createObjectURL(files[randomIndex]));
            img.src = URL.createObjectURL(files[randomIndex]);

            // Append the image to the image grid
            imageGrid.appendChild(img);

            // Set the name to display (name of the selected image without extension)
            imageName = files[randomIndex].name.split('.')[0];
            name.innerHTML = imageName;
        }

        function check(name) {
            console.log(name);
            name = name.replace("-", " ");
            if (name == currentPerson) {
                var num = Math.floor(Math.random() * (files.length));
                showName.innerHTML = names[num];
                currentPerson = names[num];
                score++;
                console.log(score);
                showScore.innerHTML = score;
                for (var i = 0; i < files.length; i++) {
                    document.getElementById(names[i].replace(" ", ))
                    var img = document.createElement("img");
                    img.className = "image";
                    imageGrid.appendChild(img);
                    img.setAttribute("src", URL.createObjectURL(files[i]))
                    img.src = URL.createObjectURL(files[i]);
                    var thisName = names[i];
                    img.id = names[i].replace(" ", "-")
                    img.onclick = functionHandler(names[i])
                }

            } else {
                document.getElementById(name).style.filter = "brightness(80%)";
            }
        }

        function checkAnswer() {
            var userAnswer = document.getElementById("answer").value;
            var correctAnswer = imageName.toLowerCase(); // Convert both answers to lowercase

            if (userAnswer.toLowerCase() == correctAnswer) { // Compare case-insensitively
                document.getElementById("result").innerText = "Correct!";
                score++;
            } else {
                document.getElementById("result").innerText = "Incorrect. Try again!";
                score--;
            }
        }

        function getNames() {
            for (var i = 0; i < files.length; i++) {
                names[i] = files[i].name.split('.')[0];
            }
        }
    </script>
</body>

</html>